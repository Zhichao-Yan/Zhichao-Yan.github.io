---
layout: post
title: Linux启动过程
date: 2025-05-18 19:16 +0800
media_subpath: "/../assets/img/pic1"
image: "../head/green.jpg"
description: Linux启动详解
categories: [操作系统,Linux]
toc: true
comments: false
math: true
mermaid: true
hidden: false
pin: true
---

1. 启动电源：计算机的电源单元（PSU）开始向主板和其他硬件组件供电
2. 启动BIOS/UEFI：在硬件加电后，CPU会从一个固定的内存地址（通常是0xFFFF0）开始执行指令
这个地址通常指向主板上的BIOS或UEFI固件
3. 执行硬件自检(POST)：BIOS或UEFI会执行硬件自检
    * CPU：检查CPU是否正常工作。
    * 内存：检测内存是否正常，通常会进行内存测试。
    * 存储设备：检查硬盘、SSD或其他存储设备是否可以被识别。
    * 其他硬件：检测显卡、网卡、键盘、鼠标等硬件设备
4. 显示自检结果
    * 检测到问题：发出蜂鸣声或显示错误信息
    * 检测正常：显示BIOS/UEFI版本和硬件信息
5. 确定启动顺序
BIOS或UEFI会根据用户在BIOS/UEFI设置中配置的启动顺序，按顺序依次启动，如果第一个加载失败，则加载第二个。
常见的启动设备包括硬盘、USB闪存盘、光驱或网络启动，可以在UEFI/BIOS中修改启动顺序
![boot](boot1.png){: w="600" h="400" }
_默认的启动顺序_
![boot](boot2.png){: w="600" h="400" }
_更改默认的启动顺序_


6. 选择启动设备，加载引导程序。BIOS或UEFI会从选定的启动设备中加载引导程序（Bootloader）
    1. 对于BIOS，引导程序通常位于硬盘的MBR（Master Boot Record）
    2. 对于UEFI，引导程序通常位于EFI系统分区（ESP）

7. 系统的ESP分区通常位于`/boot/efi`
EFI系统分区（ESP，EFI System Partition）用于存放与启动相关的文件

8. 先读取并执行ESP分区的`\EFI\ubuntu\shimaa64.efi`文件,验证`GRUB`程序
> Shim主要作用是验证后续加载的引导加载程序（GRUB）的签名，确保系统启动过程的安全性
`shimaa64.efi`是Shim的64位版本，Shim是一个开源的引导加载程序，是安全启动（Secure Boot）机制的一部分。安全启动要求启动过程中的软件组件都经过数字签名认证，防止恶意软件在启动阶段加载。
```bash
yan@ubuntu:/boot/efi/EFI/ubuntu$ ls
BOOTAA64.CSV  grubaa64.efi  grub.cfg  mmaa64.efi  shimaa64.efi
```
9. 在ubuntu中，Shim验证完成后默认会尝试加载同目录下的`grubx64.efi`,引导程序`GRUB`被加载到内存
10. `GRUB`加载自身配置，读取`/boot/grub/grub.cfg`

> `grub.cfg`是由`/etc/grub.d`和`/etc/default/grub`产生
{: .prompt-tip }


```bash
yan@ubuntu:/boot/grub$ sudo cat grub.cfg 
[sudo] password for yan: 
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#
```
11. 显示`GRUB`启动菜单：列出可用的操作系统和内核选项


